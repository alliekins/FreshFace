@model FreshFace.Models.LogOnModel

@{
    ViewBag.Title = "Log On";
    Layout = "~/Views/Shared/_GridLayout.cshtml";
}

<div class="row">
    <div class="twelve columns">

        <h2>Log On</h2>
        <p>
            Please login using Facebook.  Thanks for trying FreshFace!
        </p>

        <div id="fb-root"></div>
        <script>
          window.fbAsyncInit = function() {
            FB.init({
              appId      : "@ViewBag.AppID",
              status     : true, 
              cookie     : true,
              xfbml      : true,
              oauth      : true,
            });
            FB.Event.subscribe('auth.statusChange', function (response) {
                if (response.authResponse) {
                    var data = {
                        UserID: response.authResponse.userID
                    };
                    $.post("/Account/LogOn", data, function (resp) {
                        if (resp.Success) {
                            window.location.href = '/Home/Index';
                        }
                    });
                } 
                else {
                    if (typeof console !== "undefined") {
                        console.log("Logging out");
                    }
                }
            });
          };
          (function(d){
             var js, id = 'facebook-jssdk'; if (d.getElementById(id)) {return;}
             js = d.createElement('script'); js.id = id; js.async = true;
             js.src = "//connect.facebook.net/en_US/all.js";
             d.getElementsByTagName('head')[0].appendChild(js);
           }(document));
        </script>
        <div class="fb-login-button" 
            scope="user_events,friends_events,read_stream,create_event,publish_stream,user_photos,read_friendlists,manage_friendlists">
            Login with Facebook
        </div>

        <br />

    </div>
</div>