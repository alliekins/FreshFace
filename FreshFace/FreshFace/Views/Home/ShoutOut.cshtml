@{
    Layout = null;
}

<head>
		<meta charset="utf-8"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
        <title>@ViewBag.Title</title>
		
        <!-- Viewport stuff for mobile devices -->
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>

        <!-- Favicon -->
        <link rel="shortcut icon" href="@Url.Content("~/Content/img/favicon.ico")" type="image/x-icon" />
		
        <!-- Stuff from Foundation Grid -->
		<link href="@Url.Content("~/Content/presentation.css")" rel="stylesheet" />
		<link href="@Url.Content("~/Content/foundation.css")" rel="stylesheet" />
		<link href="@Url.Content("~/Content/app.css")" rel="stylesheet" /> 

        
	    <!--[if lt IE 9]>
		    <link rel="stylesheet" href="/Content/ie.css">
	    <![endif]-->

        <!-- End stuff from Foundation Grid -->
        
        <script src="@Url.Content("~/Scripts/jquery-1.7.2.js")" type="text/javascript"></script>
        <script src="@Url.Content("~/Scripts/json.js")" type="text/javascript"></script>
		<script src="@Url.Content("~/Scripts/Debug.js")" type="text/javascript"></script>
		<script src="@Url.Content("~/Scripts/FreshFace.js")" type="text/javascript"></script>

		<!-- 
			This script enables structural HTML5 elements in old IE.
			http://code.google.com/p/html5shim/
		-->
		<!--[if lt IE 9]>
			<script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
	</head>
	
	<body lang="en">
		
        <header id="zurBar" class="container">
            <nav class="row">
                <div class="four columns logo">
                    <table>
                    <tr>
                        <td><a href="@Url.Content("~/Home/Index")" class="ff-profile-pic ilblock prof-header"></a></td>
                        <td><h1 class="ilblock  navlinks"><a href="@Url.Content("~/Home/Index")">@Resources.Strings.FreshFace</a></h1></td>
                    </tr>
                    </table>
                </div>
                <div class="eight columns vcenter">
                    <strong class="right navlinks">
                        @if (Request.IsAuthenticated)
                        {
                            <span class="hide-on-phones">
                                @Html.Partial("_NavLinksPartial")
                            </span>
                            <ul id="mobileNav" data-reveal-id="navModal" class="show-on-phones">
                                <li>
                                    <a href="#" class="small nice button">@Resources.Strings.Actions</a>
                                    <ul>
                                        <li>
                                            @Html.Partial("_NavLinksPartial")
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        }
                    </strong>
                </div>
            </nav>
        </header>



<!DOCTYPE html>
<html lang="en">
<head>
<meta charset=utf-8>
<meta name="viewport" content="width=620">
<title>HTML5 Demo: Web Socket</title>
<link rel="stylesheet" href="../Content/shoutOut.css">
<script src="../Scripts/shout.js"></script></head>
<body>
<section id="wrapper">
    <header>
      <h1>Web Socket</h1>
    </header>

<style>
#chat { width: 97%; }
.them { font-weight: bold; }
.them:before { content: 'them '; color: #bbb; font-size: 14px; }
.you { font-style: italic; }
.you:before { content: 'you '; color: #bbb; font-size: 14px; font-weight: bold; }
#log {
  overflow: auto;
  max-height: 300px;
  list-style: none;
  padding: 0;
/*  margin: 0;*/
}
#log li {
  border-top: 1px solid #ccc;
  margin: 0;
  padding: 10px 0;
}
</style>
<article>
  <form>
    <input type="text" id="chat" placeholder="type and press enter to chat" />
  </form>
  <p id="status">Not connected</p>
  <p>Users connected: <span id="connected">0</span></p>
  <ul id="log"></ul>
</article>
<script>
    // let's invite Firefox to the party.
    if (window.MozWebSocket) {
        window.WebSocket = window.MozWebSocket;
    }

    function openConnection() {
        // uses global 'conn' object
        if (conn.readyState === undefined || conn.readyState > 1) {
            conn = new WebSocket('ws://node.remysharp.com:8001');
            conn.onopen = function () {
                state.className = 'success';
                state.innerHTML = 'Socket open';
            };

            conn.onmessage = function (event) {
                // console.log(event.data);
                var message = event.data; //JSON.parse(event.data);
                if (!(/^\d+$/).test(message)) {
                    log.innerHTML = '<li class="them">' + message.replace(/[<>&]/g, function (m) { return entities[m]; }) + '</li>' + log.innerHTML;
                } else {
                    connected.innerHTML = message;
                }
            };

            conn.onclose = function (event) {
                state.className = 'fail';
                state.innerHTML = 'Socket closed';
            };
        }
    }

    var connected = document.getElementById('connected'),
    log = document.getElementById('log'),
    chat = document.getElementById('chat'),
    form = chat.form,
    conn = {},
    state = document.getElementById('status'),
    entities = {
        '<': '<',
        '>': '>',
        '&': '&'
    };

    if (window.WebSocket === undefined) {
        state.innerHTML = 'Sockets not supported';
        state.className = 'fail';
    } else {
        state.onclick = function () {
            if (conn.readyState !== 1) {
                conn.close();
                setTimeout(function () {
                    openConnection();
                }, 250);
            }
        };

        addEvent(form, 'submit', function (event) {
            event.preventDefault();

            // if we're connected
            if (conn.readyState === 1) {
                conn.send(JSON.stringify(chat.value));
                log.innerHTML = '<li class="you">' + chat.value.replace(/[<>&]/g, function (m) { return entities[m]; }) + '</li>' + log.innerHTML;

                chat.value = '';
            }
        });

        openConnection();
    }

</script>
</a>
</section>
</body>
</html>